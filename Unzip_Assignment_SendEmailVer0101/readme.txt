try another method to realize the function.

less codes,but it can not run in MAC because I use the <WinSock2.h> and <windows.h>

Trying to get a MacOS version